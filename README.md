# POE Macro v3.0

**Path of Exile 自動化マクロ - 完全版**

高度な画像認識とログ監視を備えた Path of Exile 専用自動化ツール

## 🎯 概要

POE Macro v3.0 は、Path of Exile における **フラスコ**、**スキル**、**Tincture** の自動使用を提供する高性能マクロです。画像認識技術とログファイル監視により、安全なエリアでは自動停止し、戦闘エリアでのみ動作します。

### ✨ 主な特徴

- 🍃 **フラスコ自動使用**: 複数スロット対応、個別遅延設定
- ⚔️ **スキル自動使用**: Berserk、Molten Shell、Order! To Me! 対応
- 🎯 **Tincture自動使用**: 画像認識による状態検出
- 📊 **ログ監視**: エリア変更の自動検出、安全エリアでの自動停止
- 🖥️ **GUI管理**: リアルタイム統計、設定変更、手動操作
- 🛡️ **アンチチート対策**: 全操作にランダム遅延
- 🎮 **統合制御**: 緊急停止（F12）、一括管理

## 📋 完全実装機能

### 🍃 フラスコ自動使用
- **対応スロット**: 1, 2, 4, 5キー
- **個別設定**: スロットごとの持続時間・遅延
- **ランダム遅延**: アンチチート対策
- **独立動作**: スレッド並列処理

### ⚔️ スキル自動使用
- **Berserk (E)**: 0.3〜1.0秒ランダム間隔
- **Molten Shell (R)**: 0.3〜1.0秒ランダム間隔  
- **Order! To Me! (T)**: 3.5〜4.0秒ランダム間隔
- **統計管理**: 使用回数、最終使用時刻
- **手動使用**: GUI経由での個別操作

### 🎯 Tincture自動使用【最適化済み】
- **画像認識**: OpenCV テンプレートマッチング
- **状態検出**: Idle状態の自動検出
- **自動使用**: 検出時の即座キー入力
- **感度調整**: 0.5〜1.0 の精度設定
- **パフォーマンス**: 単一テンプレート方式で高速化

### 📊 ログ監視・安全制御
- **ファイル監視**: `Client.txt` リアルタイム解析
- **エリア検出**: 入場・退場の自動判定
- **安全エリア**: 町・隠れ家での自動停止
- **戦闘エリア**: 自動でマクロ再開
- **ファイルロック対応**: 堅牢な監視システム

### 🖥️ GUI・操作性
- **タブ式インターフェース**: 機能別整理
- **リアルタイム統計**: 使用回数、動作状況
- **設定変更**: 再起動不要の即時反映
- **ログ表示**: GUI内でのログ出力
- **手動操作**: 各機能の個別制御

## 🚀 クイックスタート

### 1. 依存関係のインストール
```bash
pip install -r requirements.txt
```

### 2. 基本動作確認
```bash
# コアテスト（依存関係なし）
python test_simple.py

# 結果: 4/4 テスト合格を確認
```

### 3. マクロ起動
```bash
# GUI モード（推奨）
python main.py

# ヘッドレスモード（バックグラウンド）
python main.py --no-gui

# デバッグモード
python main.py --debug
```

### 4. 緊急停止
- **F12キー**: 即座に全機能停止

## 📁 プロジェクト構造

```
POE_Macro_v3/
├── src/                          # ソースコード
│   ├── core/                     # コア機能
│   │   ├── config_manager.py     # 設定管理
│   │   └── macro_controller.py   # 統合制御
│   ├── features/                 # 高度機能
│   │   └── image_recognition.py  # 画像認識（最適化済み）
│   ├── modules/                  # 機能モジュール
│   │   ├── flask_module.py       # フラスコ自動使用
│   │   ├── skill_module.py       # スキル自動使用
│   │   ├── tincture_module.py    # Tincture自動使用（最適化済み）
│   │   └── log_monitor.py        # ログ監視
│   ├── gui/                      # GUI
│   │   └── main_window.py        # メインウィンドウ
│   └── utils/                    # ユーティリティ
│       ├── keyboard_input.py     # キーボード制御
│       ├── screen_capture.py     # 画面キャプチャ
│       └── image_recognition.py  # 基本画像認識
├── assets/images/                # テンプレート画像
│   └── tincture/sap_of_the_seasons/
│       └── idle/                 # Idle状態テンプレート
├── config/                       # 設定ファイル
│   └── default_config.yaml       # デフォルト設定
├── tests/                        # テストスイート
├── main.py                       # メインアプリケーション
└── test_simple.py                # コアテスト
```

## ⚙️ 設定ファイル

`config/default_config.yaml` で全機能の詳細設定が可能：

```yaml
# フラスコ設定
flask:
  slot_1:
    enabled: true
    key: "1"
    loop_delay: [19.5, 20.5]  # 秒

# スキル設定  
skills:
  berserk:
    enabled: true
    key: "e"
    interval: [0.3, 1.0]  # 秒

# Tincture設定
tincture:
  enabled: true
  key: "3"
  sensitivity: 0.7
  check_interval: 0.1  # 秒
```

## 🔧 テスト・検証

### コアテスト（依存関係なし）
```bash
python test_simple.py
# 結果: プロジェクト構造、構文チェック、設定管理、ログ監視
```

### 統合テスト（依存関係あり）
```bash
python test_integration.py
# 結果: 全モジュール統合、GUI起動テスト
```

### 包括的テスト
```bash
python test_comprehensive.py
# 結果: 全ファイル構文検証、プロジェクト健全性
```

## 📊 パフォーマンス仕様

- **CPU使用率**: 5%以下（通常動作時）
- **検出遅延**: 最大100ms（Tincture検出）
- **メモリ使用量**: 最適化済み（単一テンプレート方式）
- **応答速度**: リアルタイム統計更新

## 🛡️ セキュリティ機能

### アンチチート対策
- **ランダム遅延**: 全キー入力に0-50ms
- **押下時間ランダム化**: 50-100ms
- **間隔揺らぎ**: ループ処理の不規則化

### 安全機能
- **緊急停止**: F12キー即座停止
- **ログ監視**: 安全エリア自動検出
- **エラーハンドリング**: 堅牢な例外処理

## 🎮 実際の使用方法

### 1. ゲーム準備
- Path of Exile を起動
- キャラクターでゲーム内に入る

### 2. マクロ起動
```bash
python main.py
```

### 3. 設定確認
- GUIで各機能の有効/無効を確認
- 統計画面でリアルタイム動作を確認

### 4. 自動制御
- **戦闘エリア**: 全機能自動動作
- **町・隠れ家**: 自動停止
- **緊急時**: F12で即座停止

## 📈 技術的ハイライト

### 最新の最適化（2025-07-04）
- **画像認識**: 複雑な解像度別対応を単一テンプレートに簡略化
- **Tincture検出**: ステートマシンからシンプルループに変更
- **インポート統一**: 全ファイル絶対インポートで安定性向上
- **パフォーマンス**: メモリ使用量削減、処理速度向上

### アーキテクチャ
- **モジュラー設計**: 独立性の高いコンポーネント
- **スレッドセーフ**: 並列処理対応
- **設定駆動**: コード変更なしでの調整
- **KISS原則**: シンプルで保守しやすい構造

## 📚 関連ドキュメント

- **[要件定義書](docs/POE_Macro_v3_要件定義書.md)**: 詳細な機能仕様
- **[開発計画書](docs/POE_Macro_v3_開発計画書.md)**: プロジェクト計画
- **[開発記録](CLAUDE.md)**: 実装進捗の記録
- **[開発ガイドライン](CLAUDE_DEV.md)**: 技術詳細・アーキテクチャ

## ⚠️ 注意事項

本マクロの使用は Path of Exile の利用規約に違反する可能性があります。使用は**完全に自己責任**で行ってください。

### 推奨事項
- 適度な休憩を取る
- 長時間の連続使用を避ける
- ゲームの利用規約を遵守する

## 🏷️ バージョン情報

- **Version**: 3.0 (最終完成版)
- **Release Date**: 2025-07-04
- **Python**: 3.13.5
- **Status**: Production Ready

## 📄 ライセンス

Private Project - 個人使用のみ