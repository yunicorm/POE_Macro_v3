# GUI実装

## 概要
PyQt5を使用したタブ式GUIインターフェース。マクロの制御、統計表示、設定変更、キャリブレーション機能を統合した包括的なユーザーインターフェースです。

## 主要機能

### メインウィンドウ (main_window.py)
- **タブ式インターフェース**: 機能別に整理されたタブ
- **リアルタイム制御**: マクロの開始・停止・統計表示
- **設定管理**: 各モジュールの設定変更機能
- **キャリブレーション**: 検出エリア設定機能

### コントロールタブ
- **開始/停止ボタン**: MacroControllerとの直接連携
- **緊急停止**: F12キーでの緊急停止機能
- **ステータス表示**: 現在のマクロ状態表示
- **統計情報**: リアルタイム統計表示

### 設定タブ
- **Flask設定**: 各スロットの個別設定
- **Skill設定**: スキル別の間隔設定
- **Tincture設定**: 感度・間隔の調整
- **保存機能**: 設定の永続化

### キャリブレーションタブ
- **検出エリア設定**: オーバーレイによる視覚的設定
- **プリセット選択**: 解像度別プリセット
- **手動調整**: X,Y,幅,高さの手動設定
- **検出テスト**: 設定の動作確認

## ステータスオーバーレイ

### StatusOverlayクラス
- **常時表示**: 画面上にマクロ状態を常時表示
- **半透明背景**: 視認性確保とゲーム操作非干渉
- **ドラッグ移動**: マウスドラッグでの位置調整
- **自動保存**: 位置変更の自動保存

### 表示状態
- **マクロオン**: 緑色表示
- **マクロオフ**: 赤色表示
- **フォント調整**: マルチ解像度対応
- **クリック透過**: ゲーム操作に影響しない

### 操作機能
- **マウスオーバー**: ドラッグモード切り替え
- **位置移動**: リアルタイム位置調整
- **設定保存**: overlay_settings.yamlに自動保存
- **状態連携**: F12キー・GUIボタンとの連動

## オーバーレイウィンドウ (overlay_window.py)

### 検出エリア設定機能
- **半透明緑色矩形**: 検出エリアの視覚化
- **Always on Top**: 最前面表示
- **ドラッグ移動**: マウスドラッグでの位置調整
- **サイズ変更**: Shift+ドラッグでのサイズ変更

### キーボード操作
- **矢印キー**: 1px単位の位置調整
- **Shift+矢印**: 1px単位のサイズ調整
- **Ctrl+S**: 現在設定の保存
- **F9**: 表示/非表示切り替え
- **F10**: 設定モード終了

### 表示情報
- **座標・サイズ**: 中央に現在値表示
- **スケール情報**: 右下にスケール表示
- **リアルタイム更新**: 変更時の即座反映

## 技術仕様

### PyQt5実装
- **QMainWindow**: メインウィンドウクラス
- **QTabWidget**: タブ式インターフェース
- **QTimer**: リアルタイム更新処理
- **QThread**: 非同期処理（必要に応じて）

### 設定統合
- **ConfigManager連携**: 設定ファイルとの同期
- **リアルタイム反映**: 設定変更の即座適用
- **フォールバック**: 設定エラー時の安全な動作
- **検証機能**: 設定値の妥当性チェック

### MacroController統合
- **直接制御**: start/stopメソッドの呼び出し
- **状態監視**: get_status()による状態取得
- **統計取得**: 各モジュールの統計情報
- **エラーハンドリング**: 制御エラー時の適切な処理

## ユーザー操作フロー

### 初期設定
1. **キャリブレーションタブ**: 検出エリア設定
2. **オーバーレイ表示**: 視覚的エリア調整
3. **設定保存**: detection_areas.yamlに保存
4. **テスト実行**: 検出機能の動作確認

### 通常使用
1. **コントロールタブ**: マクロ開始
2. **ステータス確認**: オーバーレイでの状態確認
3. **統計監視**: GUIでの統計表示
4. **設定調整**: 必要に応じた設定変更

### 設定変更
1. **設定タブ**: パラメータ調整
2. **保存実行**: 設定の永続化
3. **即座反映**: 実行中モジュールへの適用
4. **動作確認**: 変更効果の確認

## 主要ファイル

### 実装ファイル
- **src/gui/main_window.py**: メインGUI実装
- **src/features/status_overlay.py**: ステータスオーバーレイ
- **src/features/overlay_window.py**: 設定オーバーレイ
- **src/features/area_selector.py**: エリア選択機能

### 設定ファイル
- **config/default_config.yaml**: デフォルト設定
- **config/detection_areas.yaml**: エリア設定
- **config/overlay_settings.yaml**: オーバーレイ設定

## 特徴

### ユーザビリティ
- **直感的操作**: 視覚的な設定調整
- **即座フィードバック**: 変更の即座反映
- **エラー耐性**: 不正設定時の安全な処理
- **詳細ログ**: 操作の追跡可能

### パフォーマンス
- **軽量実装**: 最小限のリソース使用
- **効率的更新**: 必要時のみの再描画
- **スレッドセーフ**: マルチスレッド環境対応
- **メモリ管理**: 適切なオブジェクト管理

## テスト
- **test_coordinate_sync.py**: 座標同期テスト
- **test_overlay.py**: オーバーレイ機能テスト
- **test_drag_simple.py**: ドラッグ機能テスト

## 実装効果
- **視覚的フィードバック**: マクロ状態の一目確認
- **非侵入的**: ゲーム操作に一切干渉しない
- **カスタマイズ性**: 個人環境に合わせた調整
- **操作簡便性**: 直感的で分かりやすいインターフェース