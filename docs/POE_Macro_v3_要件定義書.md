1. 機能要件
1.1. フラスコ自動使用機能
各フラスコは、マクロ起動と同時に指定されたループ処理を開始する。
対象割当キー持続時間ループタイミング (最初のキー入力後からの遅延)備考Granite Flask17.2 秒7.210秒 ～ 7.300秒 のランダムな時間-Cinderswallow Urn27.2 秒7.210秒 ～ 7.300秒 のランダムな時間-Wine of the Prophet420.0 秒20.000秒 ～ 21.000秒 のランダムな時間Divination Cardバフを付与するユニークフラスコDivine Mana Flask55.0 秒4.500秒 ～ 4.800秒 のランダムな時間-
1.2. スキル自動使用機能
各スキルは、マクロ起動と同時に指定された間隔でのキー入力を開始する。
対象割当キーキー入力間隔備考BerserkE0.3秒 ～ 1.0秒 のランダムな間隔クールダウン回復速度低下MODに対応するため、高頻度で実行。Molten ShellR0.3秒 ～ 1.0秒 のランダムな間隔同上。Order! To Me!T3.5秒 ～ 4.0秒 のランダムな間隔他のスキルより優先度を下げ、長めの間隔で実行。
1.3. Tincture (Sap of the Seasons) 自動使用機能
Tinctureは、ゲーム画面の画像認識によって状態を判別し、ループ処理を実行する。

検出対象: ゲーム画面の中央モニター(3440x1440)に表示されるTinctureスロット。
割当キー: 3
状態とアクション:

使用可能 (Idle) 状態の検出：テンプレート画像 sap_of_the_seasons_idle.png とのマッチングで状態を判定する。この状態を検出した場合、即座に 3 キーを1回入力する。
アクティブ (Active) 状態の待機：キー入力後、Tinctureがアクティブ状態になる。この間は追加のアクションは行わない。
クールダウン (Cooldown) 状態の監視：アクティブ時間が終了すると、クールダウン状態に移行する。クールダウンが完了し、「使用可能 (Idle)」状態に戻るまで待機する。
上記1〜3をループ実行する。



使用する画像アセット

Tincture状態画像:

sap_of_the_seasons_idle.png: 使用可能状態
sap_of_the_seasons_active.png: アクティブ状態
sap_of_the_seasons_cooldown_pXXX.png: クールダウン状態（XXXはプログレスバーの進行度）



1.3.1 Tincture検出エリア設定機能（新規追加）
概要：
ユーザーがゲーム画面上でフラスコスロットエリアを視覚的に指定し、その領域内でTinctureアイコンを検出する機能。
機能要件：

オーバーレイウィンドウ

半透明の緑色矩形表示
ゲーム画面の最前面に表示（Always on Top）
ホットキー（F9）で表示/非表示切り替え


エリア調整機能

マウスドラッグによる位置移動
Shift+ドラッグによるサイズ変更
マウスホイールによる全体スケール調整
矢印キーによる1ピクセル単位の微調整


設定の永続化

調整したエリア座標の自動保存
解像度別プリセット対応
設定ファイル（detection_areas.yaml）での管理


検出方式の変更

現在：画面右上1/4エリア
変更後：ユーザー指定のフラスコエリア内
Tincture位置の相対座標管理



操作仕様：
操作機能マウスドラッグ矩形の移動Shift+ドラッグサイズ変更マウスホイール全体スケール調整矢印キー1px単位の位置調整Shift+矢印サイズ調整Ctrl+S設定を保存F9オーバーレイ表示切替Escape設定モード終了
技術仕様：

tkinterまたはPyQt5でオーバーレイウィンドウ実装
透明度設定（50%程度）
クリックスルー機能（ゲーム操作を妨げない）

1.4. 将来の拡張機能
以下の機能は初期実装には含まれず、基本機能の安定稼働後に段階的に実装予定：
Divination Cardバフ検出機能

画面上部のバフエリアに表示されるDivination Cardバフアイコンの検出
Wine of the Prophet使用により付与される40種類のバフを識別
優先度情報（highest-priority～lowest-priority）に基づく管理

フラスコチャージ・プログレスバー検出機能

各フラスコのチャージ量とプログレスバーの状態を画像認識で検出
チャージが十分にある場合のみ使用する制御
アセット例：granite_flask_c060_p050.png（チャージ60%、プログレス50%）

Divination Cardバフ連動機能

検出されたバフの優先度に基づくWine of the Prophet使用制御
高優先度バフ時の制御：highest-priority, high-priority等の重要度が高いバフが適用された場合、Wine of the Prophetの使用間隔を延長
低優先度バフ時の制御：low-priority, lowest-priority等の重要度が低いバフが適用された場合、Wine of the Prophetの使用頻度を短縮

優先度別の使用間隔例（将来実装時の想定）
バフ優先度使用間隔の調整制御の狙いhighest-priority26～28秒極めて有益なバフを最大限維持high-priority24～26秒有益なバフを長く維持medium-priority20～22秒標準的な間隔で使用low-priority12～15秒低恩恵バフを早めに切り替えlowest-priority8～10秒最小恩恵バフを高頻度で切り替え
1.5. GUI設定管理機能
基本要件

ウィンドウ構成: タブ式インターフェースによるページ切り替え
リサイズ機能: ウィンドウサイズの自由な拡大縮小
設定の永続化: 変更した設定の保存と起動時の自動読み込み
設定の可搬性: 設定のエクスポート/インポート機能（プロファイル管理）

タブ構成

フラスコ設定タブ

設定項目内容スロット番号1～5のフラスコスロットフラスコ名称ドロップダウンまたはテキスト入力（例：Granite Flask, Cinderswallow Urn, Wine of the Prophet等）割り当てキーキーバインド設定（デフォルト：1, 2, 4, 5）ループ間隔最小値～最大値の範囲設定（例：7.210～7.300秒）有効/無効各スロットの自動使用ON/OFF

Tincture設定タブ

設定項目内容Tincture名称使用するTinctureの選択（例：Sap of the Seasons）装備スロットキーバインド設定（デフォルト：3）検出感度画像認識の閾値調整有効/無効Tincture自動使用のON/OFF

スキル設定タブ

設定項目内容スキル名称スキル名の入力（例：Berserk, Molten Shell, Order! To Me!）割り当てキーキーバインド設定（デフォルト：E, R, T）使用間隔最小値～最大値の範囲設定（例：0.3～1.0秒）有効/無効各スキルの自動使用ON/OFF

全般設定タブ

設定項目内容マクロ開始/停止キーグローバルホットキーの設定ログレベルデバッグ情報の出力レベル画面解像度ゲーム画面の解像度確認・調整デバッグモード画像認識結果の可視化、マッチング精度の表示テストモード各機能の個別テスト実行

自動制御タブ

設定項目内容ログ監視ログファイル監視機能のON/OFFログファイルパスClient.txtの場所（デフォルトパスから変更可能）自動ON/OFFエリア入退場での自動制御有効/無効除外エリア自動制御を適用しないエリアのリスト（例：町など）ログパターンエリア入退場を検出するための正規表現パターン

キャリブレーションタブ（新規追加）

設定項目内容検出エリア設定オーバーレイ表示ボタンプリセット選択解像度別初期値検出テストリアルタイム検出確認エリア情報表示現在の座標・サイズ
1.6. ログファイル監視機能
基本要件

監視対象: C:\Program Files (x86)\Steam\steamapps\common\Path of Exile\logs\Client.txt
検出イベント:

エリア入場: 新しいエリアへの移動を検出
エリア退場: エリアからの離脱を検出


動作仕様:

エリア入場時: マクロを自動的にON
エリア退場時: マクロを自動的にOFF
ハイドアウト経由の同一マップ再入場もエリア入場として扱う



ログパターン例（仮）
-- 入場パターン例
2025/01/15 12:34:56 Entering area "Crimson Temple"
2025/01/15 12:35:12 Entering area "Hideout"
2025/01/15 12:35:45 Entering area "Crimson Temple"

-- 退場パターン例
2025/01/15 12:40:23 Leaving area "Crimson Temple"
実装詳細

リアルタイムでログファイルの末尾を監視
新規ログエントリーを検出し、パターンマッチング実行
エリア名の記録と状態管理（現在のエリア、前回のエリア）
マクロのON/OFF制御はメインループと連携

2. 非機能要件
項目要件実行環境・OS: Windows 10/11<br>・ディスプレイ構成: 3面マルチモニター (左:1920x1080, 中央:3440x1440, 右:1920x1080)<br>・ゲーム設定: Path of Exileを中央モニターにて Windowed Fullscreen で起動。パフォーマンス・CPU使用率: 5%以下を目標<br>・画像認識処理: 100ms以内で完了<br>・メモリ使用量: 200MB以下信頼性長時間のゲームプレイセッション（数時間）において、エラーなく安定して動作すること。操作性ユーザーが単一の操作（特定のキーの組み合わせなど）でマクロ全体の開始と停止を切り替えられること。アンチチート対策全てのキー入力タイミングにミリ秒単位のランダムな揺らぎを持たせ、機械的なパターンを排除する。ユーザビリティ直感的なGUI操作。設定変更が即座に反映され、マクロの再起動が不要。設定の検証不正な値（負の数値、空欄等）の入力を防ぐバリデーション機能。拡張性新しいフラスコ、スキル、バフの追加が容易な設計。画像ファイルと設定ファイルの追加/修正のみで対応可能。保守性アセット（画像ファイル）の体系的な管理。READMEによる各ディレクトリの説明文書化。リアルタイム性ログファイルの更新を1秒以内に検出し、マクロ制御を実行。耐障害性ログファイルが一時的にアクセス不可能な場合でも、マクロ本体の動作に影響しない。エラー処理・画像認識失敗時の再試行機構<br>・ゲーム画面が見つからない場合の適切な通知<br>・設定ファイル破損時のデフォルト値での起動
3. 制約事項

本マクロは、指定された解像度およびUIスケールでのみ正常な動作を保証する。解像度やUI設定が異なる場合、画像認識の精度が低下し、意図しない動作をする可能性がある。
ゲームクライアントのアップデートにより、UI要素（フラスコやTinctureの表示位置、デザイン）が変更された場合、マクロの修正が必要となる。特に画像認識部分は影響を受けやすい。
初期バージョンでは、フラスコは固定間隔での自動使用のみ対応。チャージ量やプログレスバーの状態は考慮しない。
Wine of the Prophetは初期実装では固定間隔（約20秒）での使用となり、Divination Cardバフの状態は考慮しない。
Divination Cardバフは同時に1つのみ適用されるゲーム仕様に基づいて将来の拡張を設計。
ログファイルの場所はSteam版のデフォルトパスを想定。スタンドアロン版やEpic Games版では異なるパスになる可能性があり、手動での設定が必要。
ログファイルのフォーマットはゲームのアップデートで変更される可能性があり、その場合はログパターンの更新が必要。
本マクロの使用は、Path of Exileの利用規約に違反する可能性があります。使用によるアカウントへのいかなる不利益（アカウント停止等）についても、開発者は一切の責任を負いません。利用は完全に自己責任で行うものとします。

4. 開発フェーズ
現在の開発フェーズ：
基本機能実装（完了）

固定間隔でのフラスコ・スキル自動使用（Wine of the Prophet含む）
Tinctureの画像認識による状態検出と自動使用
GUI設定画面の実装
ログファイル監視によるマクロ自動制御

検出エリア設定機能（現在）

オーバーレイウィンドウによる視覚的エリア設定
フラスコスロットエリア内でのTincture検出

拡張機能実装（将来）

画面上部のバフエリアでのDivination Cardバフ検出
フラスコのチャージ・プログレスバー検出
Divination Cardバフ優先度による動的制御